pipeline{


agent any 
	
	stages{
		stage ('Checkout GIT'){
			steps{
				echo 'Pulling...';
					git branch: 'firas',
					url : 'https://github.com/Sandboxieh/DevOps_5SIM1';
			}
		}

		stage ("Verification du  version Maven"){
			steps{
				bat """mvn -version"""
			}
		}


		 stage ("Nettoyage"){
		 	steps{
		 		bat """mvn clean """
		 	}
		 }


 		 stage ("Creation de Livrable"){
		 	steps{
		 		bat """mvn package -Dmaven.test.skip=true"""
		 	}
		 }

		 stage ("Lancement des Tests Unitaires"){
		 	steps{
		 		bat """mvn test"""
		 	}
		 }


		 stage ("Analyse avec Sonar"){
		 	steps{
		 		bat """mvn sonar:sonar"""
		 	}
		 }

		 stage ("Deploiement vers Nexus"){
		 	steps{
		 		bat """mvn clean package -Dmaven.test.failure.ignore=true deploy:deploy-file -DgroupId=tn.esprit.spring -DartifactId=timesheet -Dversion=1.6-SNAPSHOT -DgeneratePom=true -Dpackaging=jar -DrepositoryId=deploymentRepo -Durl=http://localhost:8081/repository/maven-snapshots/ -Dfile=target/timesheet-1.6-SNAPSHOT.jar"""
		 	}
		 }
	



	
		stage('Notification par Email '){
			steps{
			mail bcc: '', body: 'Build Success', cc: '', from: '', replyTo: '', subject: 'Jenkins', to: 'firas.selmen@esprit.tn'
			}
		}
	}
	


	post{
		success{
			emailext body: 'Build success', subject: 'Jenkins', to:'firas.selmen@esprit.tn'
		}
		failure{
			emailext body: 'Build failure', subject: 'Jenkins', to:'firas.selmen@esprit.tn'
		}

	}
}